<html>
  <head>
    <script defer src="alpine.js"></script>
    <link href="tailwind.css" rel="stylesheet" />
  </head>
  <body
    x-data="{
      init: function() {
        this.setUpWordStatusRegister()
      },

      finSentences: [
        `Diego on muuttanut opiskelija-asuntoon Junatielle.`,
        `Asunto on soluasunto, jossa asuu Diegon lisäksi neljä muuta opiskelijaa.`,
        `Diego ihmettelee, miksi keittiön kaapissa on neljä erilaista jäteastiaa.`,
        `Moi Siiri, voisiks sä auttaa mua?`,
        `Mä en tiedä, mihin roskikseen nää banaaninkuoret pitää laittaa.`,
        `Joo, totta kai.`,
        `Banaaninkuoret on biojätettä.`,
        `Toi pieni vihreä astia on sitä varten.`,
        `Ahaa, okei. No mitä nää muut astiat on?`,
        `Tää iso astia on pahvipakkauksille ja toi oranssi astia on energiajätteelle.`,
        `Loput roskat on sekajätettä.`,
        `Ne voi laittaa tähän.`,
        `Mitä sekajäte oikein on?`,
        `No kaikki sellainen jäte, jota ei voi kierrättää, on sekajätettä.`,
        `Se päätyy suoraan kaatopaikalle.`,
        `Aijaa.`,
        `Tänne toiseen kaappiin me kerätään kaikki pullot ja lasipurkit.`,
        `Pullot me palautetaan kauppaan, koska niistä saa pantin.`,
        `Lasipurkit me viedään lasinkeräykseen.`,
        `Tuolla pihalla on iso jätekatos.`,
      ],

      engSentences: [
        `Diego has moved into a student apartment on Junatie.`,
        `The apartment is a cell apartment where four other students live in addition to Diego.`,
        `Diego is wondering why there are four different bins in the kitchen cabinet.`,
        `Hi Siiri, can you help me?`,
        `I don't know which bin to put the banana peels in.`,
        `Yes of course.`,
        `Banana peels are biowaste.`,
        `That little green container is for that.`,
        `Ahaa, okay. Well what are these other dishes?`,
        `This big container is for cardboard packaging and that orange container is for energy waste.`,
        `The rest of the rubbish is mixed waste.`,
        `They can be put here.`,
        `What exactly is mixed waste?`,
        `Well, all the kind of waste that can’t be recycled is mixed waste.`,
        `It ends up in landfill.`,
        `Oh right.`,
        `We collect all the bottles and glass jars in this other cupboard.`,
        `We return the bottles to the shop, because they get a deposit.`,
        `We take the glass jars to the glass recycling.`,
        `There is a big trash container in that yard.`,
      ],

      get blanks() {
        return this.words.map(word => '_____')
      },

      get hints() {
        return this.finSentences[this.sentenceI].split(' ')
          .map(word => word.split('')
          .map((letter, i) => i == 0 ? letter : '_').join(''))
      },

      get words() {
        return this.finSentences[this.sentenceI].split(' ')
      },

      setUpWordStatusRegister: function() {
        this.wordStatusRegister = this.finSentences
          .map(sentence => sentence
            .split(' ')
            .map(word => false)
          )
      },

      sentenceI: 0,
      wordStatusRegister: [],
      hintsAreShown: false,

      changeSentence: function(change) {
        if (change == 'next' && this.sentenceI < this.finSentences.length - 1) {
          this.sentenceI++
        } else if (change == 'previous' && this.sentenceI > 0) {
          this.sentenceI--
        }
      },

      resetWordStatusRegister: function() {
        this.wordStatusRegister[this.sentenceI] = this.words.map(word => false)
      },

      get sentenceStatusRegister() {
        return this.wordStatusRegister
          .map(sentenceStatusRegister => sentenceStatusRegister
          .every(status => status === true))
      },

      get progress() {
        return Math.round((this.sentenceStatusRegister
          .filter(status => status).length / this.sentenceStatusRegister.length) * 100)
      },

      get sentenceIsShown() {
        return this.wordStatusRegister[this.sentenceI].every(status => status === true)
      },

      get sentenceIsReset() {
        return this.wordStatusRegister[this.sentenceI].every(status => status === false)
      },

      showWords: function() {
        this.wordStatusRegister[this.sentenceI] = this.words.map(word => true)
      },

      resetSentence: function() {
        this.resetWordStatusRegister()
      },

      toggleHints: function() {
        this.hintsAreShown = !this.hintsAreShown
      },
    }"
    class="mx-6 my-16 grid gap-32"
    style="grid-template-columns: 1fr 400px"
  >
    <div class="text-center">
      <!-- Sentence in English and Finnish -->
      <div class="text-3xl">
        <!-- English sentence -->
        <p
          x-text="engSentences[sentenceI]"
          class="mb-8 font-mono leading-normal"
        ></p>
        <hr class="mb-8" />

        <!-- Finnish sentence -->
        <div class="font-mono leading-loose">
          <template x-for="(word, i) in words">
            <span
              @click="wordStatusRegister[sentenceI][i] = !wordStatusRegister[sentenceI][i]"
            >
              <span
                x-show="!wordStatusRegister[sentenceI][i] && !hintsAreShown"
                x-text="blanks[i]"
                class="bg-red-100 cursor-pointer rounded text-gray-600 py-1"
              ></span>
              <span
                x-show="!wordStatusRegister[sentenceI][i] && hintsAreShown"
                x-text="hints[i]"
                class="bg-red-100 cursor-pointer rounded text-gray-600 py-1"
              ></span>
              <span
                x-show="wordStatusRegister[sentenceI][i]"
                x-text="word"
                class="py-1"
              ></span>
            </span>
          </template>
        </div>

        <!-- Sentence buttons -->
        <div class="mt-16 text-lg">
          <!-- Reset button -->
          <button
            :class="sentenceIsReset ? 'pointer-events-none opacity-25' : ''"
            class="px-4 py-1 mx-2 border-2 rounded-md"
            @click="resetSentence()"
          >
            Reset
          </button>

          <!-- Hints button -->
          <button
            x-text="hintsAreShown ? 'Hide hints' : 'Show hints'"
            :class="sentenceIsShown ? 'pointer-events-none opacity-25' : ''"
            class="px-4 py-1 mx-2 border-2 rounded-md"
            @click="toggleHints()"
          ></button>

          <!-- Show all button -->
          <button
            :class="sentenceIsShown ? 'pointer-events-none opacity-25' : ''"
            class="px-4 py-1 mx-2 border-2 rounded-md"
            @click="showWords()"
          >
            Show all
          </button>
        </div>

        <!-- Navigate sentences buttons -->
        <div class="m-8 text-lg">
          <!-- Previous sentence button -->
          <button
            :class="sentenceI === 0 ? 'pointer-events-none opacity-25' : ''"
            class="px-4 py-1 mx-2 border-2 rounded-md"
            @click="changeSentence('previous')"
          >
            <-
          </button>

          <!-- Next sentence button  -->
          <button
            :class="
              sentenceI === finSentences.length - 1
                ? 'pointer-events-none opacity-25 border-2'
                : sentenceIsShown
                ? 'bg-green-300'
                : 'border-2'
            "
            class="px-4 py-1 mx-2 rounded-md"
            @click="changeSentence('next')"
          >
            ->
          </button>
        </div>
      </div>
    </div>
    <div>
      <div class="flex items-center justify-center mb-6">
        <span>Progress: </span>
        <span x-text="progress" class="ml-2 text-3xl"></span>
        <span class="ml-1 text-2xl">%</span>
      </div>
      <template x-for="(sentenceStatus, i) in sentenceStatusRegister">
        <span @click="sentenceI = i" class="px-1 leading-3">
          <br x-show="i % 10 == 0" />
          <span
            x-text="i+1"
            class="
              w-7
              py-1
              inline-block
              text-center
              rounded
              text-sm
              cursor-pointer
            "
            :class="
              sentenceStatus && i === sentenceI
                ? 'bg-green-300 font-bold'
                : sentenceStatus
                ? 'bg-green-200 hover:bg-green-300'
                : i === sentenceI
                ? 'bg-red-300 font-bold'
                : 'bg-red-200 hover:bg-red-300'
            "
          ></span>
        </span>
      </template>
    </div>
  </body>
</html>
