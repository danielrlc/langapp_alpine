<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Langapp w/ Alpine.js</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
  </head>
  <body
    @keydown.k.window="changeSentence('next')"
    @keydown.j.window="changeSentence('previous')"
    @keydown.a.window="toggleSentence()"
    @keydown.o.window="toggleHints()"
    @keydown.left.window="goToPreviousWord()"
    @keydown.right.window="goToNextWord()"
    @keydown.up.window="toggleWord(wordI)"
    @keydown.down.window="changeSentence('next')"
    x-data="{
      init: function() {
        this.setUpWordStatusRegister()
      },

      finSentences: [
        `Diego on muuttanut opiskelija-asuntoon Junatielle.`,
        `Asunto on soluasunto, jossa asuu Diegon lisäksi neljä muuta opiskelijaa.`,
        `Diego ihmettelee, miksi keittiön kaapissa on neljä erilaista jäteastiaa.`,
        `Moi Siiri, voisiks sä auttaa mua?`,
        `Mä en tiedä, mihin roskikseen nää banaaninkuoret pitää laittaa.`,
        `Joo, totta kai.`,
        `Banaaninkuoret on biojätettä.`,
        `Toi pieni vihreä astia on sitä varten.`,
        `Ahaa, okei. No mitä nää muut astiat on?`,
        `Tää iso astia on pahvipakkauksille ja toi oranssi astia on energiajätteelle.`,
        `Loput roskat on sekajätettä.`,
        `Ne voi laittaa tähän.`,
        `Mitä sekajäte oikein on?`,
        `No kaikki sellainen jäte, jota ei voi kierrättää, on sekajätettä.`,
        `Se päätyy suoraan kaatopaikalle.`,
        `Aijaa.`,
        `Tänne toiseen kaappiin me kerätään kaikki pullot ja lasipurkit.`,
        `Pullot me palautetaan kauppaan, koska niistä saa pantin.`,
        `Lasipurkit me viedään lasinkeräykseen.`,
        `Tuolla pihalla on iso jätekatos.`,
        `Kaikki jätteet voi viedä sinne.`,
        `Ohhoh, kuulostaa aika hankalalta, mut kiitti neuvoista.`,
        `Sähkölaskumme kasvaa jatkuvasti.`,
        `Vanha pakastin kuluttaa huomattavasti enemmän energiaa kuin uusi.`,
        `Olisi hyvä tarkistaa, että ikkunanne ovat tiiviit – erityisesti, jos asutte vanhassa talossa.`,
        `Toivottavasti seuraava sähkölaskunne on jo pienempi!`,
        `Vettä säästyisi, jos vähentäisitte kylpyammeessa kylpemistä ja kävisitte sen sijaan useammin suihkussa.`,
        `Tässä muutamia vinkkejä.`,
        `Teidän kannattaisi lisäksi tarkistaa kodinkoneidenne ikä.`,
        `Pesukone kannattaa käynnistää vasta kun se on täynnä.`,
        `Lopuksi vielä yksi helppo vinkki.`,
        `Haluaisitko tulla käymään meidän mökillä joskus?`,
        `Joo, tulisin tosi mielelläni!`,
        `En olisi uskonut, että Emma voittaa!`,
        `Etkö? Hän olisi voinut voittaa jo viime vuonna, jos olisi osallistunut.`,
        `Menisitkö uimaan, jos vesi olisi lämmintä?`,
        `Jos voittaisin lotossa, matkustaisin Australiaan.`,
        `Ottaisin kupin kahvia.`,
        `Sanoisitko nimesi?`,
        `Menisimmekö lomalla Portugaliin?`,
      ],

      engSentences: [
        `Diego has moved into a student apartment on Junatie.`,
        `The apartment is a cell apartment where four other students live in addition to Diego.`,
        `Diego is wondering why there are four different bins in the kitchen cabinet.`,
        `Hi Siiri, can you help me?`,
        `I don't know which bin to put the banana peels in.`,
        `Yes of course.`,
        `Banana peels are biowaste.`,
        `That little green container is for that.`,
        `Ahaa, okay. Well what are these other dishes?`,
        `This big container is for cardboard packaging and that orange container is for energy waste.`,
        `The rest of the rubbish is mixed waste.`,
        `They can be put here.`,
        `What exactly is mixed waste?`,
        `Well, all the kind of waste that can’t be recycled is mixed waste.`,
        `It ends up in landfill.`,
        `Oh right.`,
        `We collect all the bottles and glass jars in this other cupboard.`,
        `We return the bottles to the shop, because they get a deposit.`,
        `We take the glass jars to the glass recycling.`,
        `There is a big trash container in that yard.`,
        `All the waste can be taken there.`,
        `Oho, sounds quite awkward, but thanks for the tips.`,
        `Our electricity bill is constantly growing.`,
        `An old freezer consumes significantly more energy than a new one.`,
        `It would be good to check if your windows are sealed – especially if you live in an old house.`,
        `Hopefully your next electricity bill will already be smaller!`,
        `You would save water if you bathed less in the bathtub and took a shower more often instead.`,
        `Here are a few tips.`,
        `You should also check the age of your appliances.`,
        `The washing machine should only be started when it is full.`,
        `Finally, one more easy tip.`,
        `Would you like to come to our summer cottage sometime?`,
        `Yeah, I'd love to come!`,
        `I wouldn't have thought Emma would win!`,
        `Don't you? She could have won last year if she had participated.`,
        `Would you go swimming if the water was warm?`,
        `If I won the lottery, I would travel to Australia.`,
        `I'd like a cup of coffee.`,
        `Would you say your name?`,
        `Would we go on holiday to Portugal?`,
      ],

      get blanks() {
        return this.words.map(word => '_____')
      },

      get hints() {
        return this.finSentences[this.sentenceI].split(' ')
          .map(word => word.split('')
          .map((letter, i) => i == 0 ? letter : '_').join(''))
      },

      get words() {
        return this.finSentences[this.sentenceI].split(' ')
      },

      setUpWordStatusRegister: function() {
        this.wordStatusRegister = this.finSentences
          .map(sentence => sentence
            .split(' ')
            .map(word => false)
          )
      },

      sentenceI: 0,
      wordI: 0,
      wordStatusRegister: [],
      hintsAreShown: false,

      changeSentence: function(change) {
        this.wordI = 0
        if (change == 'next' && this.sentenceI < this.finSentences.length - 1) {
          this.sentenceI++
        } else if (change == 'previous' && this.sentenceI > 0) {
          this.sentenceI--
        }
      },

      get sentenceStatusRegister() {
        let register = []
        for (let i = 0; i < this.wordStatusRegister.length; i++) {
          let sentenceStatus = ''
          if (this.wordStatusRegister[i].every(status => status === true)) {
            sentenceStatus = 'learnt'
          } else if (this.wordStatusRegister[i].every(status => status === false)) {
            sentenceStatus = 'tolearn'
          } else {
            sentenceStatus = 'learning'
          }
          register[i] = sentenceStatus
        }
        return register
      },

      get progress() {
        return Math.round((this.sentenceStatusRegister
          .filter(status => status === 'learnt').length / this.sentenceStatusRegister.length) * 100)
      },

      get allWordsAreShown() {
        return this.wordStatusRegister[this.sentenceI].every(status => status === true)
      },

      get allWordsAreHidden() {
        return this.wordStatusRegister[this.sentenceI].every(status => status === false)
      },

      goToPreviousWord: function() {
        if (this.wordI > 0) {
          this.wordI--
        }
      },

      goToNextWord: function() {
        if (this.wordI < this.words.length - 1) {
          this.wordI++
        }
      },

      showAllWords: function() {
        this.wordStatusRegister[this.sentenceI] = this.words.map(word => true)
      },

      hideAllWords: function() {
        this.wordStatusRegister[this.sentenceI] = this.words.map(word => false)
      },

      toggleSentence: function() {
        this.allWordsAreHidden ? this.showAllWords() : this.hideAllWords()
      },

      toggleHints: function() {
        this.hintsAreShown = !this.hintsAreShown
      },

      instructionsAreShown: false,
      
      toggleWord: function(i) {
        this.wordStatusRegister[this.sentenceI][i] = !this.wordStatusRegister[this.sentenceI][i]
        this.wordI = i
      },

      progressModalIsShown: false,
    }"
  >
    <!-- The height is >100% to allow for a tiny scroll down on mobile, -->
    <!-- which removes the space-wasting top and bottom bars on mobile browsers. -->
    <div
      class="grid gap-8 lg:gap-16 pb-4 lg:pb-8"
      style="grid-template-rows: auto 1fr auto; height: 100.2%"
    >
      <!-- Langapp top bar -->
      <h1 class="text-2xl text-center py-3 bg-blue-200">Langapp</h1>

      <!-- Sentence in English and Finnish -->
      <div class="px-4 sm:px-8 lg:px-20 text-lg sm:text-2xl lg:text-4xl">
        <!-- English sentence -->
        <p
          x-text="engSentences[sentenceI]"
          class="mb-8 font-mono leading-normal"
        ></p>
        <hr class="mb-8" />

        <!-- Finnish sentence -->
        <div class="font-mono leading-loose">
          <template x-for="(word, i) in words">
            <span @click="toggleWord(i)">
              <span
                x-show="!wordStatusRegister[sentenceI][i] && !hintsAreShown"
                x-text="blanks[i]"
                class="
                  cursor-pointer
                  rounded-lg
                  text-gray-600
                  py-2
                  bg-gray-100
                  hover:bg-gray-200
                "
                :class="i === wordI && 'border-b-4 border-blue-300'"
              ></span>
              <span
                x-show="!wordStatusRegister[sentenceI][i] && hintsAreShown"
                x-text="hints[i]"
                class="
                  cursor-pointer
                  rounded-md
                  text-gray-600
                  py-2
                  bg-gray-100
                  hover:bg-gray-200
                "
                :class="i === wordI && 'border-b-4 border-blue-300'"
                :class="i === wordI && 'border-b-4 border-blue-300'"
              ></span>
              <span
                x-show="wordStatusRegister[sentenceI][i]"
                x-text="word"
                class="cursor-pointer py-2 hover:bg-gray-200 rounded-lg"
                :class="i === wordI && 'border-b-4 border-blue-300'"
              ></span>
            </span>
          </template>
        </div>
      </div>

      <div class="mx-8 lg:mx-20">
        <!-- Sentence buttons section -->
        <!-- Grid parent -->
        <div
          class="
            text-xs
            lg:text-lg
            text-center
            mb-0
            lg:mb-6 lg:grid lg:justify-between
          "
          style="grid-template-columns: 1fr auto 1fr"
        >
          <!-- Grid child 1: Sentence control buttons -->
          <div class="lg:justify-self-start mb-2 lg:mb-0">
            <!-- Toggle all button -->
            <button
              x-text="allWordsAreHidden ? 'Show all' : 'Hide all'"
              class="
                px-3
                lg:px-4
                py-1
                mx-2
                lg:ml-0
                border-2
                rounded-md
                border-gray-300
                hover:border-gray-400
              "
              @click="toggleSentence()"
            ></button>

            <!-- Toggle hints button -->
            <button
              x-text="hintsAreShown ? 'Hide hints' : 'Show hints'"
              :class="allWordsAreShown ? 'pointer-events-none opacity-25' : ''"
              class="
                px-3
                lg:px-4
                py-1
                mx-2
                border-2
                rounded-md
                border-gray-300
                hover:border-gray-400
              "
              @click="toggleHints()"
            ></button>
          </div>

          <!-- Grid child 2: Navigation buttons and info -->
          <div class="mb-2 lg:mb-0">
            <!-- Previous sentence button -->
            <button
              :class="sentenceI === 0 ? 'pointer-events-none opacity-25' : ''"
              class="
                px-4
                py-1
                mx-2
                border-2
                rounded-md
                border-gray-300
                hover:border-gray-400
              "
              @click="changeSentence('previous')"
            >
              <-
            </button>

            <!-- Sentence nav info -->
            <span x-text="sentenceI + 1"></span>
            <span>/</span>
            <span x-text="finSentences.length"></span>

            <!-- Next sentence button  -->
            <button
              :class="sentenceI === finSentences.length - 1 && 'pointer-events-none opacity-25'"
              class="
                px-4
                py-1
                mx-2
                border-2
                rounded-md
                border-gray-300
                hover:border-gray-400
              "
              @click="changeSentence('next')"
            >
              ->
            </button>
          </div>

          <!-- Grid child 3: Progress percent info -->
          <div class="flex items-center justify-center lg:justify-self-end">
            <span>Progress: </span>
            <span x-text="progress" class="ml-2 text-3xl"></span>
            <span class="ml-1 text-2xl">%</span>
            <button
              class="
                lg:hidden
                px-4
                py-1
                mx-6
                border-2
                rounded-md
                border-gray-300
                hover:border-gray-400
              "
              @click="progressModalIsShown = true"
            >
              Progress
            </button>
          </div>

          <!-- Open progress modal on mobile button -->
        </div>

        <!-- Progress indicators section -->
        <div
          class="hidden lg:gap-2 lg:grid"
          style="grid-template-columns: repeat(20, minmax(0, 1fr))"
        >
          <template x-for="(sentenceStatus, i) in sentenceStatusRegister">
            <span
              x-text="i + 1"
              @click="sentenceI = i"
              class="text-center rounded text-sm cursor-pointer"
              :class="
                sentenceStatus === 'tolearn' && i === sentenceI
                  ? 'bg-red-200 font-bold border-2 border-red-500'
                  : sentenceStatus === 'tolearn'
                  ? 'bg-red-100 hover:bg-red-300'
                  : sentenceStatus === 'learning' && i === sentenceI
                  ? 'bg-yellow-300 font-bold border-2 border-yellow-500'
                  : sentenceStatus === 'learning'
                  ? 'bg-yellow-100 hover:bg-yellow-300'
                  : sentenceStatus === 'learnt' && i === sentenceI
                  ? 'bg-green-300 font-bold border-2 border-green-500'
                  : 'bg-green-100 hover:bg-green-300'
                "
            ></span>
          </template>
        </div>
        <!-- <div class="mt-12">
          <div class="flex justify-center">
            <h2
              x-text="instructionsAreShown ? 'Hide instructions' : 'Show instructions'"
              @click="instructionsAreShown = !instructionsAreShown"
              class="
                text-center
                bg-gray-200
                hover:bg-gray-300
                px-4
                py-1
                rounded
                cursor-pointer
                mb-6
              "
            >
              Instructions
            </h2>
          </div>
          <div x-show="instructionsAreShown">
            <p class="mb-4">
              Translate the given English sentence into Finnish in your head.
              After translating a word, click on the blank
              <span class="bg-red-100 py-1 mx-1">______</span> to see if you
              were correct.
            </p>
            <p class="mb-4">
              If you get a word wrong, click on it again to hide it and try
              again later.
            </p>
            <p class="mb-4">
              Click on
              <span class="px-2 py-1 mx-1 border-2 rounded-md">Show all</span>
              to show all the words.
            </p>
            <p class="mb-4">
              Click on
              <span class="px-2 py-1 mx-1 border-2 rounded-md">Hide all</span>
              to hide all the words.
            </p>
            <p class="mb-4">
              Click on
              <span class="px-2 py-1 mx-1 border-2 rounded-md">Show hints</span>
              to turn the hints on. A hint is the first letter of the word and
              its length.
            </p>
            <p class="mb-4">
              Do you want to repeat this sentence later? If so, leave some or
              all the words hidden and come back to it later. If not, leave all
              the words showing.
            </p>
            <p class="mb-4">
              Click on
              <span class="px-2 py-1 mx-1 border-2 rounded-md">-></span>
              to go to the next sentence.
            </p>
            <p class="mb-4">
              Jump around between sentences by clicking on the sentence numbers
              like
              <span
                class="
                  bg-red-200
                  w-7
                  py-1
                  mx-1
                  inline-block
                  text-center
                  rounded
                  text-sm
                "
                >1</span
              >
              <span
                class="
                  bg-red-200
                  w-7
                  py-1
                  mx-1
                  inline-block
                  text-center
                  rounded
                  text-sm
                "
                >2</span
              >
              <span
                class="
                  bg-red-200
                  w-7
                  py-1
                  mx-1
                  inline-block
                  text-center
                  rounded
                  text-sm
                "
                >3</span
              >
              above.
            </p>
            <p class="mb-4">
              Your progress on each sentence is tracked above. Completed
              sentences turn green, and uncompleted sentences remain red.
            </p>
          </div>
        </div> -->
      </div>
    </div>
    <div
      class="
        fixed
        inset-0
        bg-gray-600 bg-opacity-50
        overflow-y-auto
        h-full
        w-full
        flex
        justify-center
        items-center
      "
      x-show="progressModalIsShown"
      @click="progressModalIsShown = false"
    >
      <!-- Section: Progress indicators in modal on mobile -->
      <div
        class="grid gap-2 sm:gap-4"
        style="grid-template-columns: repeat(10, minmax(0, 1fr))"
      >
        <template x-for="(sentenceStatus, i) in sentenceStatusRegister">
          <span
            x-text="i + 1"
            @click="sentenceI = i; progressModalIsShown = false;"
            class="
              text-center
              p-1
              sm:px-3 sm:py-2
              rounded
              text-sm
              sm:text-base
              cursor-pointer
            "
            :class="
                sentenceStatus === 'tolearn' && i === sentenceI
                  ? 'bg-red-200 font-bold border-2 border-red-500'
                  : sentenceStatus === 'tolearn'
                  ? 'bg-red-100 hover:bg-red-300'
                  : sentenceStatus === 'learning' && i === sentenceI
                  ? 'bg-yellow-300 font-bold border-2 border-yellow-500'
                  : sentenceStatus === 'learning'
                  ? 'bg-yellow-100 hover:bg-yellow-300'
                  : sentenceStatus === 'learnt' && i === sentenceI
                  ? 'bg-green-300 font-bold border-2 border-green-500'
                  : 'bg-green-100 hover:bg-green-300'
                "
          ></span>
        </template>
      </div>
    </div>
  </body>
</html>
